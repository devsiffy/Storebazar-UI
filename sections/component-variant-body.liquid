<style>
  .component-variant-section {
    max-width: 1200px;
    margin: 0 auto;
    padding: 40px 20px;
    font-family: var(--dm-sans-font);
  }

  .component-header {
    text-align: center;
    margin-bottom: 48px;
  }

  .component-title {
    font-size: 36px;
    font-weight: 700;
    color: var(--color-text);
    margin: 0 0 16px;
  }

  .component-description {
    font-size: 16px;
    line-height: 1.6;
    color: var(--color-text-muted);
    max-width: 800px;
    margin: 0 auto;
  }

  .variants-container {
    display: flex;
    flex-direction: column;
    gap: 32px;
  }

  .variant-panel {
    border: 1px solid #e5e5e5;
    border-radius: 8px;
    overflow: hidden;
    background: var(--color-bg);
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
  }

  .variant-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px 24px;
    background: var(--color-gray-100);
    border-bottom: 1px solid #e5e5e5;
  }

  .variant-title {
    font-size: 18px;
    font-weight: 600;
    color: var(--color-text);
    margin: 0;
  }

  .variant-swatches {
    display: flex;
    gap: 8px;
  }

  .swatch-btn {
    padding: 6px 16px;
    font-size: 14px;
    font-weight: 500;
    font-family: var(--dm-sans-font);
    border: 1px solid #d1d1d1;
    background: var(--color-bg);
    color: var(--color-text);
    cursor: pointer;
    border-radius: 4px;
    transition: all 0.2s ease;
  }

  .swatch-btn:hover {
    background: var(--color-gray-050);
  }

  .swatch-btn.active {
    background: var(--color-brand);
    color: var(--color-bg);
    border-color: var(--color-brand);
  }

  .variant-content {
    padding: 24px;
  }

  .preview-container,
  .code-container {
    display: none;
  }

  .preview-container.active,
  .code-container.active {
    display: block;
  }

  .preview-box {
    width: 100%;
    height: 400px;
    border: 1px solid #e5e5e5;
    border-radius: 4px;
    overflow: hidden;
    background: var(--color-bg);
  }

  .preview-iframe {
    width: 100%;
    height: 100%;
    border: none;
  }

  .code-wrapper {
    position: relative;
  }

  .code-pre {
    background: var(--color-gray-900);
    color: var(--color-gray-100);
    padding: 20px;
    border-radius: 4px;
    overflow-x: auto;
    margin: 0;
    font-family: 'Courier New'
    , monospace;
    font-size: 14px;
    line-height: 1.5;
    max-height: 500px;
    overflow-y: auto;
  }

  .code-pre code {
    color: var(--color-gray-100);
    white-space: pre;
  }

  .no-component-message {
    text-align: center;
    padding: 60px 20px;
    color: var(--color-text-muted);
    font-size: 16px;
  }

  @media (max-width: 768px) {
    .component-title {
      font-size: 28px;
    }

    .variant-header {
      flex-direction: column;
      align-items: flex-start;
      gap: 12px;
    }

    .preview-box {
      height: 300px;
    }
  }
</style>

{% assign target_component_name = section.settings.component_name %}
{% assign all_components = page.metafields.custom.all_components.value %}
{% assign matched_component = null %}

{% comment %} Find the matching component {% endcomment %}
{% for component in all_components %}
  {% if component.name == target_component_name %}
    {% assign matched_component = component %}
    {% break %}
  {% endif %}
{% endfor %}

<div class="component-variant-section">
  {% if matched_component %}
    {%- comment -%} Component Header {%- endcomment -%}
    <div class="component-header">
      <h1 class="component-title">{{ matched_component.name }}</h1>
      {% if matched_component.description %}
        <p class="component-description">{{ matched_component.description }}</p>
      {% endif %}
  </div>

    {%- comment -%} Component Variants {%- endcomment -%}
    {% assign component_variants = matched_component.component_variants.value %}

    {% if component_variants.size > 0 %}
      <div class="variants-container">
        {% for variant in component_variants %}
            <iframe
                class="preview-iframe"
                src="{{ variant.preview_link }}"
                title="{{ variant.title }} Preview"
                loading="lazy"></iframe>

          <div class="variant-panel">
            <div class="variant-header">
              <h2 class="variant-title">{{ variant.title }}</h2>
              <div class="variant-swatches">
                <button
                  class="swatch-btn preview-swatch active"
                  data-variant-id="variant-{{ forloop.index }}"
                  type="button">
                  Preview
                </button>
                <button
                  class="swatch-btn code-swatch"
                  data-variant-id="variant-{{ forloop.index }}"
                  type="button">
                  Code
                </button>
              </div>
            </div>

            <div class="variant-content">
              {%- comment -%} Preview Container {%- endcomment -%}
              <div class="preview-container active" data-content-id="variant-{{ forloop.index }}">
                <div class="preview-box">
                  {% if variant.preview_url %}
                    <iframe
                      class="preview-iframe"
                      src="{{ variant.preview_url }}"
                      title="{{ variant.title }} Preview"
                      loading="lazy"></iframe>
                  {% else %}
                    <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: var(--color-text-muted);">
                      No preview available
                    </div>
                  {% endif %}
                </div>
              </div>

              {%- comment -%} Code Container {%- endcomment -%}
              <div class="code-container" data-content-id="variant-{{ forloop.index }}">
                <div class="code-wrapper">
<pre class="code-pre"><code>{{ variant.code_snippet | escape }}</code></pre>
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="no-component-message">
        <p>No variants available for this component.</p>
      </div>
    {% endif %}

  {% else %}
    <div class="no-component-message">
      <p>Component "{{ target_component_name }}" not found. Please check the component name in the section settings.</p>
    </div>
  {% endif %}
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const swatchButtons = document.querySelectorAll('.swatch-btn');
    
    swatchButtons.forEach(function(button) {
      button.addEventListener('click', function() {
        const variantId = this.getAttribute('data-variant-id');
        const isPreview = this.classList.contains('preview-swatch');
        const panel = this.closest('.variant-panel');
        
        // Update active button state
        const allSwatches = panel.querySelectorAll('.swatch-btn');
        allSwatches.forEach(function(btn) {
          btn.classList.remove('active');
        });
        this.classList.add('active');
        
        // Toggle content visibility
        const previewContainer = panel.querySelector('.preview-container[data-content-id="' + variantId + '"]');
        const codeContainer = panel.querySelector('.code-container[data-content-id="' + variantId + '"]');
        
        if (isPreview) {
          previewContainer.classList.add('active');
          codeContainer.classList.remove('active');
        } else {
          previewContainer.classList.remove('active');
          codeContainer.classList.add('active');
        }
      });
    });
  });
</script>

{% schema %}
  {
    "name": "Component Variant Body",
    "settings": [
      {
        "type": "text",
        "id": "component_name",
        "label": "Component Name",
        "info": "Enter the exact name of the component you want to display (e.g., 'Button', 'Card', etc.). This must match the component name in your metaobjects.",
        "default": "None"
      }
    ],
    "presets": [
      {
        "name": "Component Variant Body"
      }
    ]
  }
{% endschema %}